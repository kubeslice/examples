#!/usr/bin/bash

kind create cluster --name=egs --config - <<EOF
apiVersion: kind.x-k8s.io/v1alpha4
kind: Cluster
nodes:
- role: control-plane
  image: kindest/node:v1.31.0@sha256:53df588e04085fd41ae12de0c3fe4c72f7013bba32a20e7325357a1ac94ba865
  # required for GPU workaround
  extraMounts:
    - hostPath: /dev/null
      containerPath: /var/run/nvidia-container-devices/all
EOF

install_metallb

# Label node so EGS will use it
#kubectl label nodes egs-control-plane node.kubernetes.io/instance-type=kind-node-12
kubectl label nodes egs-control-plane node.kubernetes.io/instance-type=nvidia-geforce-gtx-1060

# Create a couple "user" namespaces/workspaces
kubectl create ns ns1
kubectl create ns ns2

# Copy the kubeconfig where egs installer can get it
cp ~/.kube/config ./kubeconfig.yaml


